---
import BaseLayout from './BaseLayout.astro';
import Badge from '../components/ui/Badge.astro';
import Button from '../components/ui/Button.astro';

interface Props {
  frontmatter: {
    title: string;
    tagline: string;
    description: string;
    role: string;
    duration: string;
    year: string;
    team?: string;
    tags: string[];
    impact: {
      metric: string;
      value: string;
    }[];
    heroImage?: string;
    ogImage?: string;
  };
}

const { frontmatter } = Astro.props;
---

<BaseLayout
  title={frontmatter.title}
  description={frontmatter.description}
  ogImage={frontmatter.ogImage}
>
  <article class="pb-[var(--space-section)]">
    <!-- Hero -->
    <header class="py-[var(--space-section-sm)] bg-white border-b border-cloud">
      <div class="mx-auto max-w-[var(--space-container)] px-[var(--space-gutter)]">
        <!-- Breadcrumb -->
        <nav class="mb-8" aria-label="Breadcrumb">
          <ol class="flex items-center gap-2 text-sm text-mist">
            <li><a href="/work" class="hover:text-accent transition-colors">Work</a></li>
            <li>/</li>
            <li class="text-ink">{frontmatter.title}</li>
          </ol>
        </nav>

        <div class="max-w-3xl">
          <!-- Tags -->
          <div class="flex flex-wrap gap-2 mb-4">
            {frontmatter.tags.map(tag => (
              <Badge variant="accent">{tag}</Badge>
            ))}
          </div>

          <!-- Title -->
          <h1 class="text-[length:var(--text-h1)] font-semibold text-ink mb-4">
            {frontmatter.title}
          </h1>

          <!-- Tagline -->
          <p class="text-xl text-accent font-medium mb-6">
            {frontmatter.tagline}
          </p>

          <!-- Description -->
          <p class="text-lg text-mist mb-8">
            {frontmatter.description}
          </p>

          <!-- Meta grid -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-6 py-6 border-y border-cloud">
            <div>
              <p class="text-xs text-mist uppercase tracking-wider mb-1">Rôle</p>
              <p class="font-medium text-ink">{frontmatter.role}</p>
            </div>
            <div>
              <p class="text-xs text-mist uppercase tracking-wider mb-1">Durée</p>
              <p class="font-medium text-ink">{frontmatter.duration}</p>
            </div>
            <div>
              <p class="text-xs text-mist uppercase tracking-wider mb-1">Année</p>
              <p class="font-medium text-ink">{frontmatter.year}</p>
            </div>
            {frontmatter.team && (
              <div>
                <p class="text-xs text-mist uppercase tracking-wider mb-1">Équipe</p>
                <p class="font-medium text-ink">{frontmatter.team}</p>
              </div>
            )}
          </div>

          <!-- Impact metrics -->
          {frontmatter.impact && frontmatter.impact.length > 0 && (
            <div class="flex flex-wrap gap-8 pt-6">
              {frontmatter.impact.map(item => (
                <div>
                  <p class="text-2xl md:text-3xl font-semibold text-accent">{item.value}</p>
                  <p class="text-sm text-mist">{item.metric}</p>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </header>

    <!-- Hero Image -->
    {frontmatter.heroImage && (
      <div class="bg-cloud">
        <div class="mx-auto max-w-[var(--space-container-wide)] px-[var(--space-gutter)] py-8">
          <div class="aspect-[16/9] bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl flex items-center justify-center">
            <span class="text-accent/40">Hero Image</span>
          </div>
        </div>
      </div>
    )}

    <!-- Content -->
    <div class="mx-auto max-w-[var(--space-container-narrow)] px-[var(--space-gutter)] py-[var(--space-section-sm)]">
      <div class="prose prose-lg max-w-none">
        <slot />
      </div>
    </div>

    <!-- Navigation -->
    <div class="mx-auto max-w-[var(--space-container)] px-[var(--space-gutter)] pt-8 border-t border-cloud">
      <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
        <Button href="/work" variant="ghost">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
          </svg>
          Tous les projets
        </Button>
        <Button href="/contact" variant="primary">
          Discuter d'un projet similaire
        </Button>
      </div>
    </div>
  </article>
</BaseLayout>

<style is:global>
  /* Prose styles for MDX content */
  .prose {
    color: var(--color-slate);
  }

  .prose h2 {
    font-size: var(--text-h2);
    font-weight: 600;
    color: var(--color-ink);
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--color-cloud);
  }

  .prose h3 {
    font-size: var(--text-h3);
    font-weight: 600;
    color: var(--color-ink);
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .prose p {
    margin-bottom: 1.5rem;
    line-height: 1.75;
  }

  .prose ul, .prose ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
  }

  .prose strong {
    color: var(--color-ink);
    font-weight: 600;
  }

  .prose a {
    color: var(--color-accent);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .prose a:hover {
    color: var(--color-accent-hover);
  }

  .prose blockquote {
    border-left: 3px solid var(--color-accent);
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-mist);
  }

  .prose img {
    border-radius: var(--radius-lg);
    margin: 2rem 0;
  }

  .prose code {
    background: var(--color-cloud);
    padding: 0.2rem 0.4rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
  }

  .prose pre {
    background: var(--color-ink);
    color: var(--color-cloud);
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    overflow-x: auto;
    margin: 2rem 0;
  }

  .prose pre code {
    background: none;
    padding: 0;
  }

  /* Custom case study components */
  .prose .impact-snapshot {
    background: var(--color-accent-subtle);
    border-radius: var(--radius-xl);
    padding: 2rem;
    margin: 2rem 0;
  }

  .prose .decision-block {
    background: var(--color-white);
    border: 1px solid var(--color-cloud);
    border-radius: var(--radius-xl);
    padding: 2rem;
    margin: 2rem 0;
  }

  .prose .image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
  }
</style>
